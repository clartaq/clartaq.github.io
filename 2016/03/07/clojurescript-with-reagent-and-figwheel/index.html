<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.74.3" />

  <title>ClojureScript with Reagent and figwheel &middot; Yo-Dave</title>

    

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://yo-dave.com/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://yo-dave.com/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="https://yo-dave.com/css/blackburn.css">

  
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.9.0/css/all.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/lisp.min.js"></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/dos.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="https://yo-dave.com/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yo-dave.com/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yo-dave.com/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yo-dave.com/about/about"><i class='fa fa-user fa-fw'></i>About</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="https://yo-dave.com/contact/contact"><i class='fa fa-phone fa-fw'></i>Contact</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href=""></a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/clartaq" rel="me" target="_blank"><i class="fab fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/193509" rel="me" target="_blank"><i class="fab fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2011-2020, David D. Clark. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>ClojureScript with Reagent and figwheel</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>7 Mar 2016 12:00:00 AM</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://yo-dave.com/tags/clojurescript">clojurescript</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://yo-dave.com/tags/figwheel">figwheel</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://yo-dave.com/tags/reagent">reagent</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="https://yo-dave.com/tags/web-development">web development</a>
    
  </div>
  
  

</div>

  <p>I have a bit of a love/hate relationship with <a href="https://github.com/clojure/clojurescript">ClojureScript</a>. On the one hand, it is a Lisp, with all the power it entails. On the other, the development toolchain can be byzantine. With the advent of <a href="http://www.2ality.com/2015/06/web-assembly.html">WebAssembly</a> and <a href="https://github.com/lukehoban/es6features/blob/master/README.md">ECMAScript6</a>, I have hopes of seeing tail call optimization (allowing true recursion) handled in ClojureScript, if not Clojure itself. And <a href="https://github.com/reagent-project/reagent">Reagent</a> and <a href="https://github.com/bhauman/lein-figwheel">figwheel</a> can make web development (not my strong suite) much easier.</p>
<p>Reagent is a ClojureScript library wrapped around the <a href="https://facebook.github.io/react/">Reactjs</a> tool from Facebook. As with React, it is intended to handle the creation and rendering of the UI for your applications.</p>
<p>figwheel is a plugin for the Leiningen build tool used by many Clojure(Script) projects. It automatically updates your browser when you make changes to the source code of the app enabling you to see almost instantly the effects of those changes.</p>
<p>Here I talk about how easy it is to use ClojureScript with Reagent and figwheel to do some simple web development.</p>
<h2 id="you-need-to-install-java">You need to install Java</h2>
<p>You need Java to run part of the toolchain. As far as I know, you don’t need it for deploying your application. There are plenty of guides for installing Java. I won’t repeat them here. During the development of the code described here, I used version 1.8.0_74, 64-bit.</p>
<h2 id="install-leiningen">Install Leiningen</h2>
<p>If you aren’t already familiar with it, <a href="http://leiningen.org/">Leiningen</a> is the de-facto Clojure(Script) build tool. There are simple installation instructions on the project’s home page. I used version 2.6.1.</p>
<h2 id="create-a-project">Create a Project</h2>
<p>That’s pretty much all the installation work you have to do. Leiningen along with your project file will take care of the rest. “Project File?” you ask? Yes, it’s created by Leiningen too. The good folks here have created a project template that can set up a skeleton project for you. Just type the following to move to your project directory (wherever it might be — I have a <code>c:\projects</code> directory on my system) and create a new project.</p>
<pre><code class="language-dos" data-lang="dos">C:\Users\david&gt;cd \projects
C:\projects&gt;lein new reagent-figwheel rgt-fw-demo
</code></pre><p>This will create a new directory, <code>rgt-fw-demo</code>, with a skeleton project of the same name all laid out. After the command completes, you can change to the new directory and run the program.</p>
<pre><code class="language-dos" data-lang="dos">C:\projects&gt;cd rgt-fw-demo
C:\projects\rgt-fw-demo&gt;lein figwheel
</code></pre><p>After a short delay, you should see a response like the following on your terminal.</p>
<pre><code class="language-dos" data-lang="dos">Figwheel: Starting server at http://localhost:3449
Figwheel: Watching build - dev
Compiling &quot;resources/public/js/compiled/app.js&quot; from [&quot;src/cljs&quot;]...
Successfully compiled &quot;resources/public/js/compiled/app.js&quot; in 3.0 seconds.
Launching ClojureScript REPL for build: dev
Figwheel Controls:
          (stop-autobuild)                ;; stops Figwheel autobuilder
          (start-autobuild [id ...])      ;; starts autobuilder focused on optional ids
          (switch-to-build id ...)        ;; switches autobuilder to different build
          (reset-autobuild)               ;; stops, cleans, and starts autobuilder
          (reload-config)                 ;; reloads build config and resets autobuild
          (build-once [id ...])           ;; builds source one time
          (clean-builds [id ..])          ;; deletes compiled cljs target files
          (print-config [id ...])         ;; prints out build configurations
          (fig-status)                    ;; displays current state of system
  Switch REPL build focus:
          :cljs/quit                      ;; allows you to switch REPL to another build
    Docs: (doc function-name-here)
    Exit: Control+C or :cljs/quit
 Results: Stored in vars *1, *2, *3, *e holds last exception object
Prompt will show when Figwheel connects to your application
To quit, type: :cljs/quit
cljs.user=&gt;
</code></pre><p>We’ll talk about some of the details later, but if you open a browser and navigate to <code>http://localhost:3449</code>, you should see this output:</p>
<p><a href="https://yo-dave.com/static/img/2016-03-07-rgt-fw-hello-snip.PNG"><img src="https://yo-dave.com/static/img/2016-03-07-rgt-fw-hello-snip.PNG" alt=""></a></p>
<p>And, indeed we shall “FIXME” right now!</p>
<h2 id="update-and-modify-projectclj">Update and Modify project.clj</h2>
<p>In the editor of your choice, open the project.clj file. On my system, several of the dependencies were out of date, and I included some additional information sections. Make your file look like the following. Take special note of the last line.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defproject </span>rgt-fw-demo <span style="color:#e6db74">&#34;0.1.1-SNAPSHOT&#34;</span>
    <span style="color:#e6db74">:description</span> <span style="color:#e6db74">&#34;A small demo using Reagent and figwheel in Clojurescript&#34;</span>

    <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;http://example.org/sample-clojure-project&#34;</span>

    <span style="color:#e6db74">:license</span> {<span style="color:#e6db74">:name</span> <span style="color:#e6db74">&#34;The MIT License&#34;</span>
              <span style="color:#e6db74">:url</span> <span style="color:#e6db74">&#34;https://opensource.org/licenses/MIT&#34;</span>
              <span style="color:#e6db74">:distribution</span> <span style="color:#e6db74">:repo</span>}

    <span style="color:#e6db74">:dependencies</span> [[org.clojure/clojure <span style="color:#e6db74">&#34;1.8.0&#34;</span>]
                   [org.clojure/clojurescript <span style="color:#e6db74">&#34;1.9.229&#34;</span>]
                   [reagent <span style="color:#e6db74">&#34;0.6.0&#34;</span>]]

    <span style="color:#e6db74">:min-lein-version</span> <span style="color:#e6db74">&#34;2.5.3&#34;</span>

    <span style="color:#e6db74">:plugins</span> [[lein-cljsbuild <span style="color:#e6db74">&#34;1.1.4&#34;</span>]
              [lein-figwheel <span style="color:#e6db74">&#34;0.5.7&#34;</span>]]

    <span style="color:#e6db74">:clean-targets</span> <span style="color:#f92672">^</span>{<span style="color:#e6db74">:protect</span> false} [<span style="color:#e6db74">&#34;resources/public/js/compiled&#34;</span> <span style="color:#e6db74">&#34;target&#34;</span>]

    <span style="color:#e6db74">:cljsbuild</span> {<span style="color:#e6db74">:builds</span> [{<span style="color:#e6db74">:id</span> <span style="color:#e6db74">&#34;dev&#34;</span>
                          <span style="color:#e6db74">:source-paths</span> [<span style="color:#e6db74">&#34;src/cljs&#34;</span>]
                          <span style="color:#e6db74">:figwheel</span> {<span style="color:#e6db74">:on-jsload</span> <span style="color:#e6db74">&#34;rgt-fw-demo.core/main&#34;</span>}
                          <span style="color:#e6db74">:compiler</span> {<span style="color:#e6db74">:main</span> rgt-fw-demo.core
                                     <span style="color:#e6db74">:output-to</span> <span style="color:#e6db74">&#34;resources/public/js/compiled/app.js&#34;</span>
                                     <span style="color:#e6db74">:output-dir</span> <span style="color:#e6db74">&#34;resources/public/js/compiled/out&#34;</span>
                                     <span style="color:#e6db74">:asset-path</span> <span style="color:#e6db74">&#34;js/compiled/out&#34;</span>
                                     <span style="color:#e6db74">:source-map-timestamp</span> true}}

                         {<span style="color:#e6db74">:id</span> <span style="color:#e6db74">&#34;min&#34;</span>
                          <span style="color:#e6db74">:source-paths</span> [<span style="color:#e6db74">&#34;src/cljs&#34;</span>]
                          <span style="color:#e6db74">:compiler</span> {<span style="color:#e6db74">:main</span> rgt-fw-demo.core
                                     <span style="color:#e6db74">:output-to</span> <span style="color:#e6db74">&#34;resources/public/js/compiled/app.js&#34;</span>
                                     <span style="color:#e6db74">:optimizations</span> <span style="color:#e6db74">:advanced</span>
                                     <span style="color:#e6db74">:pretty-print</span> false}}]}

    <span style="color:#e6db74">:figwheel</span> {<span style="color:#e6db74">:css-dirs</span> [<span style="color:#e6db74">&#34;resources/public/css&#34;</span>]})
</code></pre></div><p>Normally, figwheel watches the source code files in your project for changes, as it notices changes in you ClojureScript files, the project is rebuilt and any relevant changes are pushed out to the browser without you having to stop the program, re-compile, launch, and refresh the browser. It&rsquo;s a big time saver. It turns out that figwheel can do something similar when the CSS in your project changes too. The content of the last line, <code>:figwheel {:css-dirs [&quot;resources/public/css&quot;]}</code>, tells figwheel where there are CSS files to monitor.</p>
<h2 id="add-some-css">Add some CSS</h2>
<p>By default, the project template doesn&rsquo;t create any CSS, but it&rsquo;s easy to do. First create a directory where we told figwheel to look.</p>
<pre><code class="language-dos" data-lang="dos">C:\projects\rgt-fw-demo&gt;mkdir resources\public\css
</code></pre><p>Now, create the file style.css and fill it with the following contents. Save the file.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-css" data-lang="css"><span style="color:#f92672">h1</span><span style="color:#f92672">,</span><span style="color:#f92672">h2</span><span style="color:#f92672">,</span><span style="color:#f92672">h3</span><span style="color:#f92672">,</span><span style="color:#f92672">h4</span><span style="color:#f92672">,</span><span style="color:#f92672">h5</span><span style="color:#f92672">,</span><span style="color:#f92672">h6</span> {
    <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">transparent</span>;
    <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">dimgray</span>;
    <span style="color:#66d9ef">font-family</span>: <span style="color:#e6db74">&#34;Segoe UI&#34;</span>, <span style="color:#e6db74">&#34;Lucida Grande&#34;</span>, Tahoma, Verdana, Helvetica,
                    Arial, <span style="color:#66d9ef">sans-serif</span>;
}

<span style="color:#f92672">body</span> {
    <span style="color:#66d9ef">font-family</span>: <span style="color:#e6db74">&#34;Segoe UI&#34;</span>, <span style="color:#e6db74">&#34;Lucida Grande&#34;</span>, Tahoma, Verdana, Helvetica,
                    Arial, <span style="color:#66d9ef">sans-serif</span>;
    <span style="color:#66d9ef">background-color</span>: <span style="color:#66d9ef">white</span>;
    <span style="color:#66d9ef">color</span>: rgb(<span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">70</span>, <span style="color:#ae81ff">70</span>);
    <span style="color:#66d9ef">font-size</span>: <span style="color:#ae81ff">0.95</span><span style="color:#66d9ef">em</span>;
}

#footer{
    <span style="color:#66d9ef">margin-bottom</span>:<span style="color:#ae81ff">30</span><span style="color:#66d9ef">px</span>;
    <span style="color:#66d9ef">font-size</span>:<span style="color:#ae81ff">0.825</span><span style="color:#66d9ef">em</span>;
    <span style="color:#66d9ef">color</span>: <span style="color:#66d9ef">silver</span>;
}

#left-column {
    <span style="color:#66d9ef">width</span>: <span style="color:#ae81ff">200</span><span style="color:#66d9ef">px</span>;
    <span style="color:#66d9ef">position</span>: <span style="color:#66d9ef">fixed</span>;
}

#right-column {
    <span style="color:#66d9ef">float</span>: <span style="color:#66d9ef">right</span>;
    <span style="color:#66d9ef">text-align</span>: <span style="color:#66d9ef">right</span>
}
</code></pre></div><p>And speaking of things webby, let&rsquo;s polish up the HTML a bit. Open the <code>resources\public\index.html</code> file and make it look like this.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en-us&#34;</span>&gt;
    &lt;<span style="color:#f92672">head</span>&gt;
        &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
        &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;css/style.css&#34;</span>&gt;
        &lt;<span style="color:#f92672">title</span>&gt;rgt-fw-demo&lt;/<span style="color:#f92672">title</span>&gt;
    &lt;/<span style="color:#f92672">head</span>&gt;
    &lt;<span style="color:#f92672">body</span>&gt;
        &lt;<span style="color:#f92672">div</span> <span style="color:#a6e22e">id</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;app&#34;</span>&gt;&lt;/<span style="color:#f92672">div</span>&gt;
        &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;js/compiled/app.js&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
        &lt;<span style="color:#f92672">script</span>&gt;<span style="color:#a6e22e">rgt_fw_demo</span>.<span style="color:#a6e22e">core</span>.<span style="color:#a6e22e">main</span>();&lt;/<span style="color:#f92672">script</span>&gt;
    &lt;/<span style="color:#f92672">body</span>&gt;
&lt;/<span style="color:#f92672">html</span>&gt;
</code></pre></div><p>These changes make clear to browsers what language we are using (US English), what character set to use (UTF-8) and provide a link to the CSS style sheet we just added to the project. After saving these changes to HTML and CSS, you can reload the page in the browser and see the following:</p>
<p><a href="https://yo-dave.com/static/img/2016-03-07-rgt-fw-hello-snip2.PNG"><img src="https://yo-dave.com/static/img/2016-03-07-rgt-fw-hello-snip2.PNG" alt=""></a></p>
<p>The text is still un-inspiring, but now it is in a snazzy sans-serif font. Woohoo!</p>
<h2 id="finally-some-interesting-clojurescript-stuff">Finally, Some Interesting ClojureScript Stuff</h2>
<p>With all of the preparatory work complete at last, we can do some work in ClojureScript.</p>
<p>This demo will consist of making changes to a single file, <code>src/cljs/rgt_fw_demo/core.cljs</code>. Initially, it looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">ns </span>rgt-fw-demo.core
    (<span style="color:#e6db74">:require</span> [reagent.core <span style="color:#e6db74">:as</span> reagent]))

(<span style="color:#66d9ef">defonce </span>app-state (<span style="color:#a6e22e">reagent/atom</span> {<span style="color:#e6db74">:text</span> <span style="color:#e6db74">&#34;Hello, what is your name? &#34;</span>}))

(<span style="color:#66d9ef">defn </span>page []
  [<span style="color:#e6db74">:div</span> (<span style="color:#f92672">@</span>app-state <span style="color:#e6db74">:text</span>) <span style="color:#e6db74">&#34;FIXME&#34;</span>])

(<span style="color:#66d9ef">defn </span><span style="color:#f92672">^</span><span style="color:#e6db74">:export</span> main []
  (<span style="color:#a6e22e">reagent/render</span> [page]
                  (<span style="color:#a6e22e">.getElementById</span> js/document <span style="color:#e6db74">&#34;app&#34;</span>)))
</code></pre></div><p>There is a single additional namespace <code>:require</code>d by the program, <code>reagent.core</code>. Here it is aliased as <code>reagent</code>, but we will shortly change that to the much shorter <code>r</code>.</p>
<p>The <code>app-state Var</code> contains some program state as a <code>Reagent</code> version of an <code>atom</code>. In Reagent, an <code>atom</code> is similar to a Clojure <code>atom</code> except that the framework monitors the created <code>Var</code> for changes during program execution. If <code>app-state</code> changes programmatically, any view components related to it will change too. If you change the value in your editor and save the file, it will look similar, but figwheel makes that change. We&rsquo;ll try to make a clearer example in a moment.</p>
<p>Next comes the definition of the <code>page</code> function. The <code>page</code> function creates what is called a <!-- raw HTML omitted -->component<!-- raw HTML omitted --> in Reagent parlance. A component is a self-contained thing that can be rendered to a web page. In this case, it will display the contents of <code>app-state</code> followed by the text &ldquo;FIXME&rdquo;.</p>
<p>The <code>main</code> function triggers rendering of the component specified (<code>page</code> in this case) into the DOM object called &ldquo;app&rdquo;. If you check the <code>index.html</code> file above, you will see just such an element. It&rsquo;s a <code>div</code> with the id &ldquo;app&rdquo;.</p>
<p>The <code>main</code> function will be largely unchanged in this demo. For now, change the reference to the <code>page</code> component to <code>home-page</code>. While you&rsquo;re at it, change the alias for reagent.core in the :require function to r. Change the usage in main too. Then delete the definitions for <code>app-space</code> and the <code>page</code>&gt; function.</p>
<p>Okay, we changed the <code>main</code> function to render a new component called <code>home-page</code>. Let&rsquo;s create it now. It&rsquo;s pretty simple.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>home-page []
  [<span style="color:#e6db74">:div</span>
   [header-component]
   [body-component]
   [footer-component]])
</code></pre></div><p>This function creates a new <code>div</code> and places three additional components in it. Notice that the <code>div</code> and its contents are described with a <a href="https://github.com/weavejester/hiccup">Hiccup</a>-like syntax. This is a way to represent HTML in Clojure(Script). I actually prefer it to HTML.</p>
<p>Notice that the three sub-components are not included as function calls (although they are created with functions, as we shall see.) Components can be composed of sub-components to any depth.</p>
<h3 id="create-a-header-component">Create a Header Component</h3>
<p>Let&rsquo;s create the first sub-component, <code>header-component</code>, by defining a <code>header-component</code> function.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>header-component []
  [<span style="color:#e6db74">:div</span>
   [<span style="color:#e6db74">:h1</span> <span style="color:#e6db74">&#34;Reasons to Love &#34;</span>
    [<span style="color:#e6db74">:a</span> {<span style="color:#e6db74">:href</span> <span style="color:#e6db74">&#34;https://github.com/reagent-project/reagent&#34;</span>} <span style="color:#e6db74">&#34;Reagent&#34;</span>]]])
</code></pre></div><p>Again we see the use of Hiccup-like syntax to build up another component. We see a new <code>div</code> and an <code>h1</code> header with text that includes a link to the Reagent project. If we were able to run the project right now, it would look like:</p>
<p><a href="https://github.com/clartaq/yo-dave/blob/master/images/2016-03-07-rgt-fw-demo-title.PNG"><img src="https://yo-dave.com/static/img/2016-03-07-rgt-fw-demo-title.PNG" alt=""></a></p>
<h3 id="a-two-column-footer">A Two-Column Footer</h3>
<p>Let&rsquo;s try something a little more complicated. Let&rsquo;s create a footer that contains two columns with the right-most column displaying the program version. First, we need the program version. Start by adding the following just below the namespace declaration.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">def </span>major-version <span style="color:#ae81ff">0</span>)
(<span style="color:#66d9ef">def </span>minor-version <span style="color:#ae81ff">1</span>)
(<span style="color:#66d9ef">def </span>patch-version <span style="color:#ae81ff">1</span>)
(<span style="color:#66d9ef">def </span>program-version (str <span style="color:#e6db74">&#34;v&#34;</span> major-version <span style="color:#e6db74">&#34;.&#34;</span> minor-version <span style="color:#e6db74">&#34;.&#34;</span> patch-version))
</code></pre></div><p>This just creates a string containing a program version number in <a href="http://semver.org/">semantic</a> form. Placement of these <code>def</code>s isn&rsquo;t really critical, I just prefer them in this location. You can put it wherever you want as long as it compiles.</p>
<p>Now add a function/component to render the footer.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>footer-component []
  [<span style="color:#e6db74">:div#footer</span>
   [<span style="color:#e6db74">:div#left-column</span>
    [<span style="color:#e6db74">:p</span> <span style="color:#e6db74">&#34;This is a two-column footer with some more complicated CSS behind it that shows the&#34;</span>
     <span style="color:#e6db74">&#34; program version right-justified.&#34;</span>]]
   [<span style="color:#e6db74">:div#right-column</span>
    [<span style="color:#e6db74">:p</span> program-version]]])
</code></pre></div><p>If you could run the program now, you would see a footer on your page that looked like this:</p>
<p><a href="https://yo-dave.com/static/img/2016-03-07-rgt-fw-demo-footer.PNG"><img src="https://yo-dave.com/static/img/2016-03-07-rgt-fw-demo-footer.PNG" alt=""></a></p>
<h3 id="create-a-body-component">Create a Body Component</h3>
<p>We&rsquo;ve referred to a <code>body</code> component in <code>home-page</code>. Let&rsquo;s create it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defn </span>body-component []
  [<span style="color:#e6db74">:div</span>
   [<span style="color:#e6db74">:p</span> <span style="color:#e6db74">&#34;Well...&#34;</span>]
    [<span style="color:#e6db74">:ul</span>
     [<span style="color:#e6db74">:li</span> <span style="color:#e6db74">&#34;It&#39;s easy. (&#34;</span>
      [<span style="color:#e6db74">:a</span> {<span style="color:#e6db74">:href</span> <span style="color:#e6db74">&#34;https://github.com/weavejester/hiccup/blob/master/project.clj&#34;</span>} <span style="color:#e6db74">&#34;Hiccup&#34;</span>]
      <span style="color:#e6db74">&#34;-like syntax is very intuitive.)&#34;</span>]
     [<span style="color:#e6db74">:li</span> <span style="color:#e6db74">&#34;It&#39;s fast. (Both development and performance.)&#34;</span>]
     [<span style="color:#e6db74">:li</span> <span style="color:#e6db74">&#34;I&#39;m a chemist&#34;</span>]
     [<span style="color:#e6db74">:li</span> <span style="color:#e6db74">&#34;and...&#34;</span>]]]
   [<span style="color:#e6db74">:p</span> <span style="color:#e6db74">&#34;It can tell time! &#34;</span> [<span style="color:#e6db74">:b</span> [clock]]])
</code></pre></div><p>Now we have a list of our favorite things about Reagent, but the program still won&rsquo;t run because of the reference to the <code>clock</code> component yet to be defined. Do it like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">(<span style="color:#66d9ef">defonce </span>timer (<span style="color:#a6e22e">r/atom</span> (<span style="color:#a6e22e">js/Date.</span>)))

(<span style="color:#66d9ef">defonce </span>time-updater (<span style="color:#a6e22e">js/setInterval</span>
                        <span style="color:#f92672">#</span>(<span style="color:#a6e22e">reset!</span> timer (<span style="color:#a6e22e">js/Date.</span>)) <span style="color:#ae81ff">1000</span>))

(<span style="color:#66d9ef">defn </span>clock []
  (<span style="color:#66d9ef">let </span>[time-str (-&gt; <span style="color:#f92672">@</span>timer
                     .toTimeString
                     (<span style="color:#a6e22e">clojure.string/split</span> <span style="color:#e6db74">&#34; &#34;</span>)
                     first)]
    [<span style="color:#e6db74">:span</span> time-str]))
</code></pre></div><p>This snippet starts with the declaration of the <code>timer atom</code>. But this is no vanilla Clojure atom; it&rsquo;s a Reagent atom. The magic here is that Reagent monitors changes to these atoms and causes components that use them to be re-rendered.</p>
<p>The <code>timer-updater Var</code> starts up an anonymous function that updates the <code>timer atom</code> every second. Even though it updates the value of timer, it doesn&rsquo;t <!-- raw HTML omitted -->do<!-- raw HTML omitted --> anything with it.</p>
<p>The <code>clock</code> function creates a component that <!-- raw HTML omitted -->does<!-- raw HTML omitted --> use the value of <code>timer</code>. Not only that, because <code>timer</code> is a Reagent atom, the function is re-rendered every time <code>timer</code> changes value, that is every second. So the component includes a dynamically updated display of the time.</p>
<p>The home-page should look something like this in your browser:</p>
<p><a href="https://yo-dave.com/static/img/2016-03-07-rgt-fw-demo-home-page.PNG"><img src="https://yo-dave.com/static/img/2016-03-07-rgt-fw-demo-home-page.PNG" alt=""></a></p>
<p>You should see your actual time that continually updates. All of the machinery for updating the view as the program state changes is out of site in the Reagent/React internals. We get the goodness for almost nothing.</p>
<p>The <code>Var</code>s containing program state can be arbitrarily complex and there can be any number of them. You can treat them just like regular ol&rsquo; Clojure atoms but any components that use that state get updated as it changes. All for almost free.</p>
<p>It&rsquo;s like magic.</p>
<p><!-- raw HTML omitted -->The complete project is available as a <a href="https://www.mercurial-scm.org/">Mercurial</a> repository on <a href="https://bitbucket.org/David_Clark/rgt-fw-demo">BitBucket</a>.<!-- raw HTML omitted --> (<strong>Broken Link</strong>) This project is no longer available in a repository.</p>
<p><strong>Update 2016-09-25</strong>: Fixed a bug in the HTML where a <code>&lt;ul&gt;</code> element was embedded inside a <code>&lt;p&gt;</code> element. Updated dependencies in the project file. Updated the version number in the project and source file (although it is not shown in the copy of the screen shot.)</p>
  
  

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://yo-dave.com/2016/02/22/river5-on-windows/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://yo-dave.com/2016/02/22/river5-on-windows/">River5 on Windows</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://yo-dave.com/2016/04/12/a-new-blogging-platform/">A New Blogging Platform</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://yo-dave.com/2016/04/12/a-new-blogging-platform/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://yo-dave.com/js/ui.js"></script>
<script src="https://yo-dave.com/js/menus.js"></script>






<script src="https://yo-dave.com/js/math-code.js"></script>
  <script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  


</body>
</html>

